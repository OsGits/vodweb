# vodweb

轻量级的聚合影视站，基于 PHP 7，整合采集接口并提供快速缓存与简洁前端。

## 简介
- 聚合第三方影视接口，提供首页、分类、搜索、详情、播放等页面。
- 内置文件级缓存与错误回退，提升加载速度与稳定性。
- 播放页采用令牌隐藏真实视频地址，并对 m3u8 链接使用 anyn.cc 代理播放。

## 特性
- 接口文件缓存（JSON/XML），按业务设置 TTL（详情 1 小时，列表 5 分钟等）。
- 失败回退到过期缓存，缓解接口波动导致的不可用。
- m3u8 通过 `http://anyn.cc/m3u8/?url=` 代理嵌入播放，兼容 PC/移动端。
- 播放页隐藏真实链接（令牌 token + 集数索引），地址栏不暴露视频 URL。
- 播放页底部分集列表，当前集高亮，快速切换。
- 分类映射与显示名替换（在 `vodfl.php` 中配置）。
- 详情简介清理：去 HTML 标签、处理 `&nbsp;`、保留合理换行。
- 播放源名称别名映射（如 `lzm3u8 → 电信线路`）。

## 更新历史（简短）
- v0.1：初始页面与基础结构。
- v0.2：接口文件缓存与错误回退、压缩传输、超时优化。
- v0.3：播放页令牌化隐藏真实链接，m3u8 走 anyn.cc 代理；分集列表与高亮。
- v0.4：详情简介内容清理；详情页缓存 TTL 调整为 1 小时。
- v0.5：仅保留 m3u8 分线与链接；播放源名称别名映射。
- v0.6：首页精选外部文件移除并内联逻辑；性能与体验优化。

## 目录结构与说明
```
.
├── assets/                # 静态资源（样式、占位图）
│   ├── placeholder.svg
│   └── style.css
├── cache/                 # 接口返回内容的文件缓存目录（自动创建）
├── lib/
│   ├── api.php            # 接口请求、缓存、解析（含 m3u8 分线解析、别名）
│   └── categories.php     # 分类获取与前端映射应用
├── partials/
│   ├── header.php         # 页头
│   └── footer.php         # 页脚
├── config.php             # 站点配置与通用函数（会话、URL、令牌存取）
├── index.php              # 首页（最新更新瀑布流）
├── category.php           # 分类页列表
├── search.php             # 搜索页
├── detail.php             # 详情页（简介清理、剧集列表）
├── play.php               # 播放页（令牌取回真实链接、分集列表与高亮）
└── vodfl.php              # 分类映射与显示名规则
```

## 使用说明
- 环境需求：
  - `PHP 7.0+`（Windows/Linux/Mac 均可），开启会话；
  - Web 服务器或 PHP 内置服务器；`cache/` 目录需可写。
- 启动（示例，PHP 内置服务器）：
  - PowerShell/终端执行：
    ```
    php -S localhost:8000 -t x:\wwwroot\127.0.0.1
    ```
  - 浏览：`http://localhost:8000/`
- 播放：
  - m3u8 链接自动通过 `anyn.cc` 代理嵌入；普通 `mp4` 等走原生 `<video>`。
  - 播放页地址形如：`/play.php?token=...&ep=...`，不会暴露真实播放 URL。

## 配置说明
- 修改采集源地址：`config.php` 中的 `API_BASE`。
- 播放源别名：`lib/api.php` 的 `play_source_name_aliases()`，示例：
  ```php
  return [
      'lzm3u8' => '电信线路',
      'liangzi' => '联通线路',
  ];
  ```
- 分类映射与显示名：编辑 `vodfl.php`（支持按名称或 ID 映射/隐藏）。
- 缓存 TTL：`lib/api.php` 的 `api_ttl()`，按接口类型与参数设置过期时间。

## 常见操作
- 清空缓存：删除 `cache/*.cache` 文件。
- 调整播放页样式：`play.php` 中播放器容器（m3u8 为 16:9 自适应，`<video>` 高度自动）。
- 安全增强建议：若需进一步隐藏真实 m3u8，可实现服务端代理（`proxy_m3u8.php`），令牌带签名与过期校验。

---
如需自定义 UI、增加来源、或优化解析策略（如剧集去重/排序、跨源合并），可在 `lib/api.php` 与相关页面中直接扩展。
